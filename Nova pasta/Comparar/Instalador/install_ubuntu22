#!/bin/bash

instancia_add=$1

if [[ ! ${instancia_add} ]]; then
    print_banner
    print "üíª Por favor, digite o nome da Inst√¢ncia que ser√° criada:"
    read -p "> " instancia_add
fi

# Skip profile creation
# print_banner
# printf "Enter user name (for deploy user): "
# read -p "> " user_name

# print_banner
# printf "Enter password (for deploy user): "
# read -p "> " user_password

# print_banner
# printf "Enter password (for postgres user): "
# read -p "> " password_db

# Skip repository selection
# print_banner
# print "üíª Enter your GITHUB token to connect the repository: "
# read -p "> " token_github

# print_banner
# print "üíª Enter the repository link (ex: https://github.com/user/repo.git): "
# read -p "> " repository_github

# if [[ -z "$token_github" || -z "$repository_github" ]]; then
#     print "${RED} üíª Token or repository not provided. Installation cannot continue.${GRAY_LIGHT}"
#     exit 1
# fi

print_banner
printf "üíª Enter the database name (the name will be created in the database): "
read -p "> " database_name

print_banner
printf "üíª Enter the name of the Instance (this will be the name of the website): "
read -p "> " instancia_name

print_banner
printf "üíª Enter the user limit: "
read -p "> " user_limit

print_banner
printf "üíª Enter the connection limit: "
read -p "> " connection_limit

print_banner
printf "üíª Enter the port for the Frontend (ex: 3000): "
read -p "> " frontend_port

print_banner
printf "üíª Enter the port for the Backend (ex: 8080): "
read -p "> " backend_port

print_banner
printf "üíª Enter the domain for the Frontend (ex: dominio.com): "
read -p "> " frontend_url

print_banner
printf "üíª Enter the domain for the Backend (ex: api.dominio.com): "
read -p "> " backend_url

print_banner
printf "üíª Enter the port for the Redis service (ex: 6379): "
read -p "> " redis_port

# Uncomment IP service if needed
# print_banner
# printf "üíª Enter the IP address of the Redis service (ex: 127.0.0.1): "
# read -p "> " redis_ip

# Skip N8N and Typebot integration
# print_banner
# print "üíª Enter the N8N domain (ex: n8n.dominio.com): "
# read -p "> " n8n_url

# print_banner
# print "üíª Enter the N8N port (ex: 5678): "
# read -p "> " n8n_port

# print_banner
# print "üíª Enter the Typebot domain (ex: typebot.dominio.com): "
# read -p "> " typebot_url

# print_banner
# print "üíª Enter the Typebot port (ex: 3001): "
# read -p "> " typebot_port

# Read only for debugging
# print_banner
# printf "‚úÖ Debug Mode: On? [y/N] "
# read -p "> " debug_mode

# Pergunta sobre infraestrutura de providers (n√£o configura√ß√£o espec√≠fica)
get_flowbuilder_infra

# Deploy dependencies
system_ubuntu22_dependencies

# Setup PostgreSQL
system_ubuntu22_postgres

# Setup backend
# system_ubuntu22_backend

# Instalar infraestrutura de providers
setup_whatsapp_providers_infra

# Instalar depend√™ncias da infraestrutura
install_providers_infra_dependencies

# Instalar depend√™ncias frontend (se necess√°rio)
install_frontend_infra_dependencies

# Criar estrutura de diret√≥rios
setup_providers_directory_structure

# Preparar Nginx para webhooks
setup_nginx_webhooks_preparation

# Testar instala√ß√£o da infraestrutura
test_providers_infra_installation

# Mostrar informa√ß√µes p√≥s-instala√ß√£o
show_post_installation_info

# Skip frontend setup for now
# system_ubuntu22_frontend

# Skip Redis setup for now
# system_ubuntu22_redis

# Skip N8N setup for now
# system_ubuntu22_n8n

# Skip Typebot setup for now
# system_ubuntu22_typebot

# Skip cron jobs for now
# system_ubuntu22_cron

# Skip PM2 setup for now
# system_ubuntu22_pm2

# Skip Nginx setup for now
# system_ubuntu22_nginx

# Skip SSL setup for now
# system_ubuntu22_ssl

# Skip firewall setup for now
# system_ubuntu22_firewall

# Skip final verification for now
# verify_installation