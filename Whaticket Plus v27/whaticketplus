#!/bin/bash

# WhatiTicket Plus - Instalador Autom√°tico
# Compat√≠vel com Ubuntu 20.04, 22.04 e 24.04 LTS

# Cores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Banner
echo -e "${BLUE}"
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë                                                          ‚ïë"
echo "‚ïë          üöÄ WHATICKET PLUS - INSTALADOR AUTO             ‚ïë"
echo "‚ïë                                                          ‚ïë"
echo "‚ïë          üì± Sistema de Atendimento WhatsApp              ‚ïë"
echo "‚ïë          üîß Instala√ß√£o Autom√°tica Ubuntu LTS             ‚ïë"
echo "‚ïë                                                          ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}\n"

# Detectar vers√£o do Ubuntu
UBUNTU_VERSION=$(lsb_release -rs 2>/dev/null || echo "unknown")
UBUNTU_CODENAME=$(lsb_release -cs 2>/dev/null || echo "unknown")

echo -e "${YELLOW}üîç Detectando sistema...${NC}"
echo -e "   üíª Ubuntu: ${GREEN}$UBUNTU_VERSION ($UBUNTU_CODENAME)${NC}"

# Verificar compatibilidade e escolher script
case $UBUNTU_VERSION in
    "20.04")
        echo -e "   ‚úÖ Sistema: ${GREEN}Ubuntu 20.04 LTS - Totalmente suportado${NC}"
        SCRIPT="Instalador/install_primaria"
        ;;
    "22.04")
        echo -e "   ‚úÖ Sistema: ${GREEN}Ubuntu 22.04 LTS - Recomendado${NC}"
        SCRIPT="Instalador/install_ubuntu22"
        ;;
    "24.04")
        echo -e "   ‚úÖ Sistema: ${GREEN}Ubuntu 24.04 LTS - Suportado${NC}"
        SCRIPT="Instalador/install_ubuntu22"
        ;;
    *)
        echo -e "   ‚ö†Ô∏è  Sistema: ${YELLOW}Ubuntu $UBUNTU_VERSION - N√£o testado${NC}"
        echo -e "   üìã Vers√µes recomendadas: 20.04, 22.04, 24.04"
        echo ""
        read -p "   ü§î Continuar mesmo assim? (s/N): " -n 1 -r
        echo
        if [[ ! $REPLY =~ ^[SsYy]$ ]]; then
            echo -e "${RED}‚ùå Instala√ß√£o cancelada${NC}"
            exit 1
        fi
        SCRIPT="Instalador/install_ubuntu22"
        ;;
esac

echo ""
echo -e "${BLUE}üéØ Iniciando instala√ß√£o...${NC}"
echo -e "   üìÇ Script: ${GREEN}$SCRIPT${NC}"
echo ""

# Verificar se o script existe
if [[ ! -f "$SCRIPT" ]]; then
    echo -e "${RED}‚ùå Erro: Script $SCRIPT n√£o encontrado${NC}"
    echo -e "   üìÅ Arquivos dispon√≠veis em Instalador/:"
    ls -la Instalador/ | grep install
    exit 1
fi

# Tornar execut√°vel
chmod +x "$SCRIPT"

# Verificar se √© root
if [[ $EUID -ne 0 ]]; then
    echo -e "${YELLOW}‚ö†Ô∏è  Este script precisa ser executado como root${NC}"
    echo -e "   üí° Execute: ${GREEN}sudo $0${NC}"
    exit 1
fi

# Executar instala√ß√£o
echo -e "${GREEN}üöÄ Executando instala√ß√£o...${NC}"
echo "=============================================="
exec "$SCRIPT"